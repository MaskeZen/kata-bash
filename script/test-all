#!/bin/bash

assert_equal() {
    local expected="$1"
    local actual="$2"
    if diff -u <(echo "$expected") <(echo "$actual")
    then
        echo "$(tput setaf 2)PASS$(tput sgr0)"
    else
        echo "$(tput setaf 1)FAIL$(tput sgr0)"
        echo "Failed at ${BASH_LINENO[0]}"
        echo "Expected: $expected"
        echo "  Actual: $actual"
        return 1
    fi
}

source bin/add

assert_output() {
    local expected_output="$1"; shift
    local command_args="$@"

    local output="$("$@")"

    assert_equal "$expected_output" "$output" ||
        echo "Mi aspettavo che il comando \`${command_args[*]}\` desse:
$expected_output
Invece mi ha dato: $output"
}
assert_output "2" add "2"

assert_equal "1" "$(add "1")"
assert_equal "2" "$(add "2")"
assert_equal "3" "$(add "1,2")"
assert_equal "6" "$(add "1,2,3")"

assert_equal "6" "$(bin/add 1,2,3)"
assert_equal "" "$(source bin/add)"

